(this["webpackJsonpklimatkoll-client"]=this["webpackJsonpklimatkoll-client"]||[]).push([[0],{37:function(e,t,n){"use strict";n.r(t);var a=n(13),r=n.n(a),i=n(22),o=n.n(i),s=n(5),c=n(2),d=n(1),u=n(3),l=n(20),m=n(19),f=n(41),v=n(10),h=[482,590],p=[482,-50],g=Math.PI/5,b=[482,270],k=[860,173],_=[860,367],y=function(){function e(t,n,a){Object(d.a)(this,e),this.id=void 0,this.name=void 0,this.container=void 0,this.position=[0,0],this.scale=e.DEFAULT_SCALE,this.rotation=0,this.addedRotation=0,this.zLevel=0,this.isSpace=!1,this.visible=!0,this.flipped=!1,this.id=t,this.name=n,"space"===n&&(this.isSpace=!0),this.container=a}return Object(u.a)(e,null,[{key:"getRectangle",value:function(t){var n=e.DEFAULT_WIDTH*t.scale,a=e.DEFAULT_HEIGHT*t.scale;return[[-n/2,-a/2],[n/2,a/2]]}},{key:"transpose",value:function(e,t,n){var a=Object(c.a)({},e);return void 0!==t.position&&(a.position=[E(e.position[0],t.position[0],n),E(e.position[1],t.position[1],n)]),void 0!==t.rotation&&(a.rotation=E(e.rotation,t.rotation,n)),void 0!==t.addedRotation&&(a.addedRotation=E(e.addedRotation,t.addedRotation,n)),void 0!==t.scale&&(a.scale=E(e.scale,t.scale,n)),a}}]),e}();function E(e,t,n){if(n>200)return t;var a=n/200;return e+(t-e)*(1-Math.pow(1-a,2))}y.DEFAULT_WIDTH=445,y.DEFAULT_HEIGHT=656,y.DEFAULT_SCALE=.275;var D=function(e){Object(l.a)(n,e);var t=Object(m.a)(n);function n(e){return Object(d.a)(this,n),t.call(this,e,"space","emissions-line")}return n}(y),w=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,null,[{key:"rearrange",value:function(e,t){var n=0,a=e.cards.filter((function(e){return"hand"===e.container})).length-1;return e.cards=e.cards.map((function(r){if("hand"!==r.container)return r;var i=g*(n-a/2),o=h[0]+160*Math.sin(i),s=h[1]-80*Math.cos(i),c=y.DEFAULT_SCALE;r.zLevel=n+10,j.getFocusedCardID(e)===r.id&&(s=h[1]-230,c=2*y.DEFAULT_SCALE,i=0,r.zLevel=999);var d={position:[o,s],rotation:.5*i,scale:c};return n+=1,y.transpose(r,d,t)})),e}}]),e}(),C=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,null,[{key:"rearrange",value:function(e,t){var n=0,a=e.cards.filter((function(e){return"opponent-hand"===e.container})).length-1;return e.cards=e.cards.map((function(e){if("opponent-hand"!==e.container)return e;var r=g*(n-a/2)+Math.PI,i={position:[p[0]+160*Math.sin(r),p[1]-80*Math.cos(r)],rotation:.5*(r+Math.PI)};return n+=1,y.transpose(e,i,t)})),e}}]),e}(),I=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,null,[{key:"rearrange",value:function(e,t){var n=(e=Object(c.a)({},e)).emissionsLineCardOrder.reduce((function(t,n){var a=e.cards.find((function(e){return e.id===n}));if(!a)throw new Error("Can't find card with ID: "+n);return[].concat(Object(s.a)(t),[a])}),[]),a=n.length,r=y.DEFAULT_WIDTH*y.DEFAULT_SCALE,i=r/2;r*a>450&&(i=(450-r)/(a-1));var o=0-i*a/2-i/2;return n=n.map((function(n,a){var r={};if(r.scale=y.DEFAULT_SCALE,r.position=[b[0]+o+i*(a+1),b[1]],n.zLevel=a,n.visible=!0,n.isSpace){void 0===e.selectedCardID&&(n.visible=!1),n.name="space";var s=e.cards.find((function(t){return t.id===e.selectedCardID}));void 0!==s&&j.getFocusedCardID(e)===n.id&&(n.name=s.name)}else void 0!==e.selectedCardID&&j.getFocusedCardID(e)===n.id&&(r.scale=2*y.DEFAULT_SCALE,n.zLevel=999);return y.transpose(n,r,t)})),j.updateCards(e,n)}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e=Object(c.a)({},e),t.flipped=!0,e.cards.push(t),e.emissionsLineCardOrder=[].concat(Object(s.a)(e.emissionsLineCardOrder.slice(0,n+1)),[t.id],Object(s.a)(e.emissionsLineCardOrder.slice(n+1,e.emissionsLineCardOrder.length))),e.emissionsLineCardOrder=e.emissionsLineCardOrder.filter((function(e){return e>=0})).reduce((function(e,t,n){return[].concat(Object(s.a)(e),[t,-1-(n+1)])}),[-1]),e.cards=e.cards.filter((function(e){return!e.isSpace}));var a=e.emissionsLineCardOrder.filter((function(e){return e<0})).reduce((function(t,n,a){return e.cards.findIndex((function(e){return e.id===n}))>-1?t:[].concat(Object(s.a)(t),[new D(-1-a)])}),[]);return e.cards=[].concat(Object(s.a)(e.cards),Object(s.a)(a)),e}}]),e}(),j=function(){function e(){Object(d.a)(this,e),this.cards=[],this.emissionsLineCardOrder=[],this.isMyTurn=!1,this.socketID=-1,this.hoveredCardIDs=new Set,this.selectedCardID=void 0,this.statusMessage=""}return Object(u.a)(e,null,[{key:"getFocusedCardID",value:function(e){return Array.from(e.hoveredCardIDs)[0]}},{key:"getFocusedCard",value:function(t){var n=e.getFocusedCardID(t);return t.cards.find((function(e){return e.id===n}))}},{key:"getSelectedCard",value:function(e){return e.cards.find((function(t){return t.id===e.selectedCardID}))}},{key:"mouseClicked",value:function(t,n,a){var r=e.getFocusedCardID(t);if(void 0===r)t.selectedCardID=void 0;else{var i=t.cards.find((function(e){return e.id===r}));i&&"hand"===i.container&&(t.selectedCardID=r)}return t=I.rearrange(t,a),Object(c.a)({},t)}},{key:"nextCard",value:function(e,t,n){var a=e.cards.filter((function(e){return"deck"!==e.container})),r=t.payload.card,i=new y(r.id,r.name,"deck");return i.position=k,a.push(i),Object(c.a)(Object(c.a)({},e),{},{cards:a})}},{key:"incorrectCardPlacement",value:function(e,t,n){e=Object(c.a)({},e);var a={position:_,rotation:0,addedRotation:0};return e.cards=e.cards.map((function(e){return e.id!==t.payload.cardID?e:(e.flipped=!0,y.transpose(Object(c.a)(Object(c.a)({},e),{},{container:"discard-pile"}),a,n))})),e.selectedCardID=void 0,e=w.rearrange(e,n),e=C.rearrange(e,n)}},{key:"updateCards",value:function(e,t){return e.cards=e.cards.map((function(e){var n=t.find((function(t){return t.id===e.id}));return n||e})),e}},{key:"fromEvents",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();return t.reduce((function(t,a){var r=n-a.timestamp;switch(a.event_type){case"waiting_for_players":t.statusMessage="V\xe4ntar p\xe5 spelare #2";break;case"playing":break;case"draw_card":var i=a.payload.card;if(a.payload.socketID===t.socketID){var o=new y(i.id,i.name,"hand");o.position=k,t.cards.push(o),t=w.rearrange(t,r)}else{var s=new y(i.id,i.name,"opponent-hand");s.position=k,t.cards.push(s),t=C.rearrange(t,r)}break;case"return_opponent_hand":break;case"card_played_from_deck":var c=a.payload.card,d=a.payload.position;t=I.add(t,new y(c.id,c.name,"emissions-line"),d),t=I.rearrange(t,r);break;case"card_played_from_hand":var u=t.cards.find((function(e){return e.id===a.payload.cardID})),l=a.payload.position;if(!u)throw new Error("Played card does not exist with ID: "+a.payload.cardID);t.selectedCardID=void 0;var m=new y(u.id,u.name,"emissions-line");m.position=u.position,t.cards=t.cards.filter((function(e){return e!==u})),t=I.add(t,m,l),t=I.rearrange(t,r),t=w.rearrange(t,r),t=C.rearrange(t,r);break;case"incorrect_card_placement":t=e.incorrectCardPlacement(t,a,r);break;case"player_turn":t.socketID===a.payload.socketID?(t.isMyTurn=!0,t.statusMessage="Din tur"):(t.isMyTurn=!1,t.statusMessage="Andra spelarens tur");break;case"game_won":t.socketID===a.payload.socketID?t.statusMessage="Du vann!":t.statusMessage="Du f\xf6rlorade!";break;case"vote_new_game":break;case"next_card":t=e.nextCard(t,a,r);break;case"card_hovered":var f=a.payload.card_id;t.hoveredCardIDs.add(f),t=w.rearrange(t,r),t=I.rearrange(t,r);break;case"card_unhovered":var v=a.payload.card_id;t.hoveredCardIDs.delete(v),t=w.rearrange(t,r),t=I.rearrange(t,r);break;case"mouse_clicked":t=e.mouseClicked(t,a,r);break;case"socket_id":t.socketID=a.payload.socketID}return t}),new e)}}]),e}(),O=n(40),x=n(39),T=function(){function e(t){Object(d.a)(this,e),this.streams$=void 0,this.streams$=t}return Object(u.a)(e,[{key:"get",value:function(){return this.streams$.reduce((function(e,t){return[].concat(Object(s.a)(e),Object(s.a)(t.value))}),[]).sort((function(e,t){return(e.event_id||0)-(t.event_id||0)})).sort((function(e,t){return e.timestamp-t.timestamp})).map((function(e,t){return Object(c.a)(Object(c.a)({},e),{},{event_id:t})}))}},{key:"observable",value:function(){var e=this.streams$[0];return this.streams$.slice(1,this.streams$.length).forEach((function(t){e=e.pipe(Object(O.a)(t),Object(x.a)((function(e){return e.reduce((function(e,t){return[].concat(Object(s.a)(e),Object(s.a)(t))}),[])})))})),e.pipe(Object(x.a)((function(e){var t=new f.a(e);return L.from([t]).get()})))}}]),e}(),L=function(){function e(t,n,a,r){Object(d.a)(this,e),this.event_id=void 0,this.event_type=void 0,this.payload=void 0,this.timestamp=void 0,this.event_id=t,this.event_type=n,this.payload=a,this.timestamp=r}return Object(u.a)(e,null,[{key:"from",value:function(e){return new T(e)}}]),e}(),A=[{name:"aggmackor",emissions:120},{name:"bilresa-stockholm-are",emissions:50},{name:"bilresa-stockholm-goteborg",emissions:80},{name:"bilresor-genomsnitt",emissions:1400},{name:"blandkost-genomsnitt",emissions:2e3},{name:"blandkost-kor",emissions:4500},{name:"blandkost-kyckling",emissions:1e3},{name:"bussresa-malmo-chamonix",emissions:60},{name:"dator-paslagen",emissions:110},{name:"duscha-5min",emissions:30},{name:"duscha-10min",emissions:120},{name:"duscha-15min",emissions:500},{name:"flaskkarre",emissions:400},{name:"flygresa-malmo-chamonix",emissions:300},{name:"flygresa-stockholm-are",emissions:300},{name:"flygresa-stockholm-goteborg",emissions:250},{name:"flygresa-sverige-bangkok",emissions:1600},{name:"flygresa-sverige-newyork",emissions:1200},{name:"flygresor-genomsnitt",emissions:650},{name:"grasklippning-bensindriven",emissions:60},{name:"grot",emissions:60},{name:"halloumiburgare",emissions:350},{name:"handdiska",emissions:20},{name:"hund",emissions:50},{name:"kycklingben",emissions:200},{name:"laderskor",emissions:160},{name:"ny-dator",emissions:350},{name:"ny-telefon",emissions:50},{name:"nytt-kok",emissions:2400},{name:"ostmackor",emissions:250},{name:"paketfrakt-flyg-kina",emissions:250},{name:"paketfrakt-lastbil-tyskland",emissions:10},{name:"pendla-biodieselbil",emissions:4e3},{name:"pendla-buss",emissions:200},{name:"pendla-cykel",emissions:10},{name:"pendla-elbil",emissions:550},{name:"pendla-liten-dieselbil",emissions:2200},{name:"pendla-stor-dieselbil",emissions:2700},{name:"rida",emissions:250},{name:"rosor-holland",emissions:350},{name:"rosor-kenya",emissions:50},{name:"sockerartor-holland",emissions:10},{name:"sockerartor-kenya",emissions:100},{name:"tagresa-stockholm-goteborg",emissions:10},{name:"tbenstek",emissions:3e3},{name:"tv",emissions:60},{name:"uppvarmning-bergvarme",emissions:600},{name:"uppvarmning-el",emissions:1800},{name:"uppvarmning-fjarrvarme",emissions:1200},{name:"uppvarmning-lagenhet",emissions:700},{name:"vegan",emissions:500},{name:"vegetarian",emissions:900},{name:"vegofarssas",emissions:100},{name:"yoghurt",emissions:200}].map((function(e,t){return Object(c.a)(Object(c.a)({},e),{},{id:t})})),S=function(){function e(t,n){Object(d.a)(this,e),this.card=void 0,this.gl=void 0,this.translationLocation=void 0,this.scaleLocation=void 0,this.rotationLocation=void 0,this.selectedLocation=void 0,this.isSpaceLocation=void 0,this.visibleLocation=void 0,this.texCoordLocation=0,this.frontTexCoordBuffer=void 0,this.backTexCoordBuffer=void 0,this.positionBuffer=void 0,this.program=void 0,this.texture=void 0,this.selected=!1,this.card=n,this.gl=t;var a=-222.5,r=222.5,i=-328,o=[a,i,r,i,a,328,a,328,r,i,r,328],s=e.textures.get(n.name);if(!s)throw new Error("No card texture exists with name '"+n.name+"'");var c=R(t,t.VERTEX_SHADER,"\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\n\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform float u_scale;\nuniform float u_rotation;\nvarying vec2 v_texcoord;\n\nvoid main() {\n  mat2 rotation_matrix = mat2(\n    cos(u_rotation), -sin(u_rotation),\n    sin(u_rotation), cos(u_rotation)\n  );\n  vec2 position = a_position * rotation_matrix * vec2(u_scale) + u_translation;\n\n  vec2 zeroToOne = position / u_resolution;\n\n  vec2 zeroToTwo = zeroToOne * 2.0;\n\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\n  v_texcoord = a_texcoord;\n}\n"),u=R(t,t.FRAGMENT_SHADER,"\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform bool u_selected;\nuniform bool u_isspace;\nuniform bool u_visible;\n\nvarying vec2 v_texcoord;\n\nvec2 CARD_SIZE = vec2(445, 656);\nvec2 TEXTURE_SIZE = vec2(1024, 1024);\n\nvoid main() {\n  if (u_visible == false)\n  {\n    gl_FragColor = vec4(0.0);\n    return;\n  }\n\n  vec2 texcoord = vec2(v_texcoord.x, v_texcoord.y) ;\n\n  vec4 color = texture2D(u_texture, v_texcoord);\n\n  vec2 uv = v_texcoord * TEXTURE_SIZE;\n\n  if (u_selected == true)\n  {\n    if (uv.x < 19.0 || uv.x > CARD_SIZE.x - 11.0 ||\n        uv.y < 19.0 || uv.y > CARD_SIZE.y - 11.0)\n    {\n      color = vec4(1.0, 0.0, 0.0, color.a);\n    }\n  }\n\n  if (u_isspace == true)\n  {\n    color.a = 0.5;\n  }\n\n  gl_FragColor = color;\n}\n"),l=function(e,t,n){var a=e.createProgram();if(!a)throw new Error("Failed to create WebGL program");if(e.attachShader(a,t),e.attachShader(a,n),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error("Could not create program:\n"+e.getProgramInfoLog(a));return a}(t,c,u),m=t.getAttribLocation(l,"a_position"),f=t.getUniformLocation(l,"u_resolution"),v=t.getUniformLocation(l,"u_translation"),h=t.getUniformLocation(l,"u_scale"),p=t.getUniformLocation(l,"u_rotation"),g=t.getAttribLocation(l,"a_texcoord"),b=t.getUniformLocation(l,"u_selected"),k=t.getUniformLocation(l,"u_isspace"),_=t.getUniformLocation(l,"u_visible"),y=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,y),t.bufferData(t.ARRAY_BUFFER,new Float32Array(o),t.STATIC_DRAW),t.useProgram(l),t.enableVertexAttribArray(m),t.bindBuffer(t.ARRAY_BUFFER,y),t.uniform2f(f,t.canvas.width,t.canvas.height);var E=t.FLOAT;t.vertexAttribPointer(m,2,E,!1,0,0);var D=t.createBuffer();!function(){t.bindBuffer(t.ARRAY_BUFFER,D);var e=.0078125,n=.0078125,a=.4345703125,r=.640625;t.bufferData(t.ARRAY_BUFFER,new Float32Array([e,n,a,n,e,r,e,r,a,n,a,r]),t.STATIC_DRAW)}(),t.enableVertexAttribArray(g),t.vertexAttribPointer(g,2,t.FLOAT,!1,0,0);var w=t.createBuffer();!function(){t.bindBuffer(t.ARRAY_BUFFER,w);var e=.4501953125,n=.0078125,a=.869140625,r=.640625;t.bufferData(t.ARRAY_BUFFER,new Float32Array([e,n,a,n,e,r,e,r,a,n,a,r]),t.STATIC_DRAW)}(),t.uniform2f(f,t.canvas.width,t.canvas.height),this.program=l,this.translationLocation=v,this.scaleLocation=h,this.rotationLocation=p,this.selectedLocation=b,this.isSpaceLocation=k,this.visibleLocation=_,this.texCoordLocation=g,this.texture=s,this.backTexCoordBuffer=D,this.frontTexCoordBuffer=w,this.positionBuffer=y}return Object(u.a)(e,null,[{key:"prepareTextures",value:function(t){return new Promise((function(n,a){var r=0;[].concat(Object(s.a)(A),[{id:-1,name:"space",emissions:0}]).forEach((function(a){var i=new Image;i.src="cards/".concat(a.name,"-pair.small.png"),i.onload=function(){var o=t.createTexture();if(t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.generateMipmap(t.TEXTURE_2D),!o)throw new Error("texture is null");e.textures.set(a.name,o),++r===A.length&&n(null)}}))}))}},{key:"render",value:function(e){var t=e.gl,n=e.translationLocation,a=e.scaleLocation,r=e.rotationLocation,i=e.selectedLocation,o=e.isSpaceLocation,s=e.visibleLocation,c=e.texCoordLocation,d=e.frontTexCoordBuffer,u=e.backTexCoordBuffer,l=e.program;if(t.useProgram(l),e.card.flipped?t.bindBuffer(t.ARRAY_BUFFER,d):t.bindBuffer(t.ARRAY_BUFFER,u),t.enableVertexAttribArray(c),t.vertexAttribPointer(c,2,t.FLOAT,!1,0,0),!n)throw new Error("Could not find WebGL translation location");t.uniform2fv(n,e.card.position),t.uniform1f(a,e.card.scale),t.uniform1f(r,e.card.rotation+e.card.addedRotation),t.uniform1i(i,e.selected?1:0),t.uniform1i(o,e.card.isSpace?1:0),t.uniform1i(s,e.card.visible?1:0),t.bindTexture(t.TEXTURE_2D,e.texture),t.drawArrays(t.TRIANGLES,0,6)}},{key:"delete",value:function(e,t){t.deleteBuffer(e.frontTexCoordBuffer),t.deleteBuffer(e.backTexCoordBuffer),t.deleteBuffer(e.positionBuffer)}}]),e}();function R(e,t,n){var a=e.createShader(t);if(!a)throw new Error("Failed to create shader of type "+t);if(e.shaderSource(a,n),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))throw new Error("Could not compile shader:\n"+e.getShaderInfoLog(a));return a}S.textures=new Map;var F=[],U=function(){function e(t){Object(d.a)(this,e),this.gl=void 0;var n=t.getContext("webgl");if(!n)throw new Error("gl is null");if(this.gl=n,!n)throw new Error("Failed to initialize WebGL");n.viewport(0,0,n.canvas.width,n.canvas.height),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.gl=n}return Object(u.a)(e,[{key:"prepare",value:function(){return S.prepareTextures(this.gl)}},{key:"render",value:function(e){var t=this.gl;t.clearColor(1,1,1,1),t.clear(t.COLOR_BUFFER_BIT),e.cards.forEach((function(n){var a=F.find((function(e){return e.card.id===n.id}));if(a){a.card=n;var r=S.textures.get(n.name);if(!r)throw new Error("Could not find texture with name '"+n.name+"'");a.selected=e.selectedCardID===a.card.id,a.texture=r}else a=new S(t,n),F.push(a)})),F.filter((function(t){return void 0===e.cards.find((function(e){return e.id===t.card.id}))})).forEach((function(e){S.delete(e,t)})),(F=F.filter((function(t){return e.cards.find((function(e){return e.id===t.card.id}))}))).sort((function(e,t){return e.card.zLevel<t.card.zLevel?-1:e.card.zLevel>t.card.zLevel?1:0})).forEach((function(e){S.render(e)}))}}]),e}(),B=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,null,[{key:"intersects",value:function(e,t){var n=v.a.create();v.a.copy(n,t);var a=v.a.fromValues(e.position[0],e.position[1]),r=v.a.fromValues(0,0);v.a.rotate(n,n,r,-e.rotation),v.a.rotate(a,a,r,-e.rotation),v.a.subtract(n,n,a);var i=y.getRectangle(e);return n[0]>i[0][0]&&n[0]<i[1][0]&&n[1]>i[0][1]&&n[1]<i[1][1]}},{key:"onMoved",value:function(t,n,a,r){var i=[];return t.cards.forEach((function(o){if(e.intersects(o,a)){if(!n.has(o.id)){if(t.selectedCardID){if("emissions-line"===o.container&&!o.isSpace)return}else if("emissions-line"===o.container&&o.isSpace)return;i.push({event_type:"card_hovered",payload:{card_id:o.id},timestamp:r})}n.add(o.id)}else n.has(o.id)&&i.push({event_type:"card_unhovered",payload:{card_id:o.id},timestamp:r}),n.delete(o.id)})),{events:i,hoveredCardIDs:n}}}]),e}(),M=n(0);function P(e){var t=function(){var e=document.getElementById("roomID");if(!e)throw new Error("Can't get roomID input");return e.value};return Object(M.jsxs)("div",{style:{background:"#181543",width:"100%",height:"100%",paddingTop:"100px",boxSizing:"border-box"},children:[Object(M.jsx)("img",{style:{width:"300px",margin:"auto",paddingBottom:"30px",display:"block"},src:"logo.webp",alt:"Klimatkoll logga"}),Object(M.jsx)("input",{id:"roomID",type:"text",placeholder:"Spelets namn"}),Object(M.jsx)("button",{onClick:function(){return function(){var n=t();e.createGame(n)}()},className:"pink",children:"Skapa spel"}),Object(M.jsx)("button",{onClick:function(){return function(){var n=t();e.joinGame(n)}()},className:"yellow",children:"G\xe5 med i spel"})]})}function G(e){var t=e.status,n=e.leaveGame,a=e.roomID;return Object(M.jsxs)("div",{id:"status-bar",children:[Object(M.jsxs)("div",{className:"room-id",children:["Rum: ",a]}),Object(M.jsx)("div",{className:"status-bar-message",children:t}),Object(M.jsx)("button",{className:"pink",onClick:function(){return n()},children:"L\xe4mna spel"})]})}var $=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,null,[{key:"setupCommands",value:function(e,t){window.showGameState=function(){var n=L.from([e,t]).get();return j.fromEvents(n)},window.getGameStateGenerationTime=function(){var n=L.from([e,t]).get(),a=performance.now();return j.fromEvents(n),performance.now()-a}}}]),e}(),N=function(e){Object(l.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).commands$=new f.a([]),a.serverEvents$=new f.a([]),a.streams$=[a.commands$,a.serverEvents$],a.events$=void 0,a.events=[],a.socket=void 0,a.socketID=void 0,a.timeout=void 0,a.handledServerEventIDs=new Set,a.hoveredCardIDs=new Set,$.setupCommands(a.serverEvents$,a.commands$),a.state={currentPage:"menu",notification:"",showNotification:!1,statusMessage:""},a}return Object(u.a)(n,[{key:"connect",value:function(){var e=this,t=window.location.hostname;"localhost"===t&&(t+=":4200"),console.log(t);var n=new WebSocket("ws://"+t,"echo-protocol");n.onopen=function(t){e.notify("Uppkopplad till servern")},n.onmessage=function(t){var n=JSON.parse(t.data);switch(console.log(n),n.type){case"socketID":e.socketID=n.payload,e.addCommand({event_type:"socket_id",payload:{socketID:e.socketID},timestamp:Date.now()});break;case"room_joined":var a=n.payload.roomID;e.setState({roomID:a}),e.notify("Gick med i spel med ID: "+a),e.setState({currentPage:"game"});break;case"room_full":e.notify("Kan inte g\xe5 med i rum: Rummet \xe4r fullt");break;case"room_exists":e.notify("Kunde inte skapa rum: Rum med samma ID existerar redan");break;case"room_left":n.payload.socketID===e.socketID?e.notify("L\xe4mnade spelet"):e.notify("Andra spelaren l\xe4mnade spelet"),e.setState({currentPage:"menu"}),e.serverEvents$.next([]),e.commands$.next([]),e.handledServerEventIDs=new Set([]),e.addCommand({event_type:"socket_id",payload:{socketID:e.socketID},timestamp:Date.now()});break;case"new_game":break;case"events":e.addServerEvents(n.payload)}},n.onclose=function(t){console.log("Socket closed"),e.notify("Tappade uppkoppling till servern. F\xf6rs\xf6ker koppla upp igen.",!1),setTimeout((function(){e.connect()}),1e3)},this.socket=n}},{key:"getGameState",value:function(){return j.fromEvents(this.events)}},{key:"addServerEvents",value:function(e){var t=this,n=e.filter((function(e){return!t.handledServerEventIDs.has(e.event_id)})).map((function(e){return Object(c.a)(Object(c.a)({},e),{},{timestamp:Date.now()})}));e.forEach((function(e){t.handledServerEventIDs.add(e.event_id)})),this.serverEvents$.next([].concat(Object(s.a)(this.serverEvents$.value),Object(s.a)(n)))}},{key:"addCommand",value:function(e){var t=this.getGameState();switch(e.event_type){case"mouse_clicked":var n=j.getFocusedCard(t);if(t.isMyTurn&&t.selectedCardID&&n&&n.isSpace){var a=t.emissionsLineCardOrder.findIndex((function(e){return n.id===e}));this.sendCommand({context:"game",type:"card_played_from_hand",payload:{cardID:t.selectedCardID,position:a}})}}this.commands$.next([].concat(Object(s.a)(this.commands$.value),[Object(c.a)(Object(c.a)({},e),{},{event_id:this.commands$.value.length})]))}},{key:"sendCommand",value:function(e){this.socket&&this.socket.send(JSON.stringify(e))}},{key:"joinGame",value:function(e){this.sendCommand({context:"menu",type:"join_game",payload:{roomID:e}})}},{key:"createGame",value:function(e){this.sendCommand({context:"menu",type:"create_game",payload:{roomID:e}})}},{key:"leaveGame",value:function(){this.sendCommand({context:"room",type:"exit_game",payload:{}})}},{key:"notify",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.setState({notification:e,showNotification:!0}),!0===n&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){t.setState({showNotification:!1})}),1e3))}},{key:"componentDidMount",value:function(){var e=this;this.connect(),this.events$=L.from([this.serverEvents$,this.commands$]).observable(),this.events$.subscribe((function(t){var n=j.fromEvents(t);e.setState({statusMessage:n.statusMessage})}));var t=document.getElementById("klimatkoll-canvas");if(!t)throw new Error("Element with ID 'klimatkoll-canvas' not found");t.onmousemove=function(t){var n=t.target;if(!n)throw new Error("e.target is null");var a=n.getBoundingClientRect(),r=v.a.fromValues(t.clientX-a.left,t.clientY-a.top),i=e.getGameState(),o=B.onMoved(i,e.hoveredCardIDs,r,Date.now());o.events.forEach((function(t){return e.addCommand(t)})),e.hoveredCardIDs=o.hoveredCardIDs},t.onclick=function(t){var n=t.target;if(!n)throw new Error("e.target is null");var a=n.getBoundingClientRect(),r=v.a.fromValues(t.clientX-a.left,t.clientY-a.top);e.addCommand({event_type:"mouse_clicked",payload:{position:r},timestamp:Date.now()})},this.setState({canvasElem:t});var n=new U(t);n.prepare().then((function(){setInterval((function(){e.events=L.from(e.streams$).get();var t=e.getGameState();n.render(t)}),1e3/60)}))}},{key:"render",value:function(){var e,t=this,n=this.state.currentPage,a=this.state.notification,r=this.state.showNotification,i=this.state.statusMessage,o=this.state.roomID;return"game"===n&&(e=Object(M.jsx)(G,{roomID:o,leaveGame:function(){return t.leaveGame()},status:i})),Object(M.jsxs)("div",{id:"app",children:[Object(M.jsx)("div",{className:"notification"+(r?" show":""),children:a}),Object(M.jsx)("div",{style:{display:"menu"===n?"block":"none",height:"100%"},children:Object(M.jsx)(P,{joinGame:this.joinGame.bind(this),createGame:this.createGame.bind(this)})}),Object(M.jsx)("canvas",{style:{display:"game"===n?"block":"none"},id:"klimatkoll-canvas",width:"960",height:"540"}),e]})}}]),n}(a.Component);o.a.render(Object(M.jsx)(r.a.StrictMode,{children:Object(M.jsx)(N,{})}),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.43ab14d8.chunk.js.map